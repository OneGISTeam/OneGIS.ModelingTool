#ifndef OSGSHADOW_MINIMALCULLBOUNDSSHADOWMAP
#define OSGSHADOW_MINIMALCULLBOUNDSSHADOWMAP 1

#include <VBF_Engine/VBF_Shadow/MinimalShadowMap>

namespace osgShadow {

class OSGSHADOW_EXPORT MinimalCullBoundsShadowMap : public MinimalShadowMap
{
    public :
        /** Convenient typedef used in definition of ViewData struct and methods */
        typedef MinimalCullBoundsShadowMap ThisClass;
        /** Convenient typedef used in definition of ViewData struct and methods */
        typedef MinimalShadowMap           BaseClass;

        /** Classic OSG constructor */
        MinimalCullBoundsShadowMap();

        /** Classic OSG cloning constructor */
        MinimalCullBoundsShadowMap(
            const MinimalCullBoundsShadowMap& mcbsm, 
            const osg::CopyOp& copyop=osg::CopyOp::SHALLOW_COPY);

        /** Declaration of standard OSG object methods */
        META_Object( osgShadow, MinimalCullBoundsShadowMap );

    protected:
        /** Classic protected OSG destructor */
        virtual ~MinimalCullBoundsShadowMap(void);

        struct OSGSHADOW_EXPORT ViewData: public MinimalShadowMap::ViewData
        {
            virtual void init( ThisClass * st, osgUtil::CullVisitor * cv );

            virtual void cullShadowReceivingScene(  );

            virtual void aimShadowCastingCamera( const osg::Light *light,
                const osg::Vec4 &worldLightPos,
                const osg::Vec3 &worldLightDir,
                const osg::Vec3 &worldLightUp
                = osg::Vec3(0,1,0) );

            typedef std::vector< osgUtil::RenderLeaf* > RenderLeafList;

            static unsigned RemoveOldRenderLeaves
                ( RenderLeafList &rllNew, RenderLeafList &rllOld );

            static unsigned RemoveIgnoredRenderLeaves( RenderLeafList &rll );

            static osg::BoundingBox ComputeRenderLeavesBounds
                ( RenderLeafList &rll, osg::Matrix & projectionToWorld );

            static osg::BoundingBox ComputeRenderLeavesBounds
                ( RenderLeafList &rll, osg::Matrix & projectionToWorld, osg::Polytope & polytope );

            static void GetRenderLeaves
                ( osgUtil::RenderBin *rb, RenderLeafList &rll );
        };

        META_ViewDependentShadowTechniqueData( ThisClass, ThisClass::ViewData )
};

} // namespace osgShadow

#endif
